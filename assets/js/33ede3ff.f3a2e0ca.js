"use strict";(self.webpackChunkdatadata_docs=self.webpackChunkdatadata_docs||[]).push([[3226],{8010:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>o});var r=s(6070),t=s(1100);const d={title:"Merge",sidebar_position:9},l=void 0,i={id:"query/dql/merge",title:"Merge",description:"\u65b9\u6cd5",source:"@site/docs/query/02_dql/merge.md",sourceDirName:"query/02_dql",slug:"/query/dql/merge",permalink:"/datadata-docs/docs/query/dql/merge",draft:!1,unlisted:!1,editUrl:"https://github.com/hungtcs/datadata-docs/tree/master/docs/query/02_dql/merge.md",tags:[],version:"current",lastUpdatedBy:"hungtcs",lastUpdatedAt:1723536826e3,sidebarPosition:9,frontMatter:{title:"Merge",sidebar_position:9},sidebar:"docs",previous:{title:"DataFrameGroupBy",permalink:"/datadata-docs/docs/query/dql/dataframe_group_by"},next:{title:"Math \u6a21\u5757",permalink:"/datadata-docs/docs/query/dql/math"}},a={},o=[{value:"\u65b9\u6cd5",id:"\u65b9\u6cd5",level:2},{value:"merge",id:"merge",level:3},{value:"\u53c2\u6570",id:"\u53c2\u6570",level:4},{value:"\u4e0d\u517c\u5bb9\u7684\u7ec6\u8282",id:"\u4e0d\u517c\u5bb9\u7684\u7ec6\u8282",level:4},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:3},{value:"\u6821\u9a8c\u53c2\u6570\u683c\u5f0f",id:"\u6821\u9a8c\u53c2\u6570\u683c\u5f0f",level:4},{value:"inner \u5408\u5e76",id:"inner-\u5408\u5e76",level:4},{value:"left \u5408\u5e76",id:"left-\u5408\u5e76",level:4},{value:"right \u5408\u5e76",id:"right-\u5408\u5e76",level:4},{value:"outer \u5408\u5e76",id:"outer-\u5408\u5e76",level:4},{value:"cross \u5408\u5e76",id:"cross-\u5408\u5e76",level:4}];function c(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u65b9\u6cd5",children:"\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.h3,{id:"merge",children:"merge"}),"\n",(0,r.jsxs)(n.p,{children:["\u7c7b\u4f3c\u4e8e SQL \u7684 ",(0,r.jsx)(n.code,{children:"JOIN"})," \u64cd\u4f5c\uff0c\u5c06\u4e24\u4e2a\u6570\u636e\u6846\u5408\u5e76\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"DataFrame.merge(right, how='inner', on=None, left_on=None, right_on=None, suffixes=('_x', '_y'))\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u53c2\u6570",children:"\u53c2\u6570"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"right"}),": \u53f3\u4fa7\u6570\u636e\u6846\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"how"}),": \u5408\u5e76\u7684\u65b9\u5f0f\u3002\u652f\u6301\u4ee5\u4e0b\u503c\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"inner"}),": \u5185\u8fde\u63a5\uff0c\u8fd4\u56de\u4e24\u4e2a\u6570\u636e\u6846\u7684\u4ea4\u96c6\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"outer"}),": \u5916\u8fde\u63a5\uff0c\u8fd4\u56de\u4e24\u4e2a\u6570\u636e\u6846\u7684\u5e76\u96c6\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"left"}),": \u5de6\u8fde\u63a5\uff0c\u8fd4\u56de\u5de6\u4fa7\u6570\u636e\u6846\u7684\u6240\u6709\u884c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"right"}),": \u53f3\u8fde\u63a5\uff0c\u8fd4\u56de\u53f3\u4fa7\u6570\u636e\u6846\u7684\u6240\u6709\u884c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cross"}),": \u7b1b\u5361\u5c14\u79ef\uff0c\u8fd4\u56de\u6240\u6709\u7ec4\u5408\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"on"}),": \u5217\u540d\uff0c\u7528\u4e8e\u8fde\u63a5\u7684\u952e\u3002\u5982\u679c ",(0,r.jsx)(n.code,{children:"left_on"})," \u548c ",(0,r.jsx)(n.code,{children:"right_on"})," \u4e5f\u8bbe\u7f6e\u4e86\uff0c\u5c06\u5ffd\u7565\u6b64\u53c2\u6570\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"left_on"}),": \u5de6\u4fa7\u6570\u636e\u6846\u4e2d\u7528\u4e8e\u8fde\u63a5\u7684\u952e\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"right_on"}),": \u53f3\u4fa7\u6570\u636e\u6846\u4e2d\u7528\u4e8e\u8fde\u63a5\u7684\u952e\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"suffixes"}),": \u5408\u5e76\u540e\u7684\u5217\u540d\u540e\u7f00\u3002\u9ed8\u8ba4\u4e3a ",(0,r.jsx)(n.code,{children:"('_x', '_y')"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u4e0d\u517c\u5bb9\u7684\u7ec6\u8282",children:"\u4e0d\u517c\u5bb9\u7684\u7ec6\u8282"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u5408\u5e76\u540e\u7684 DataFrame \u5217\u987a\u5e8f\u53ef\u80fd\u4e0e Pandas \u4e0d\u4e00\u81f4\u3002\uff08\u4f46\u6570\u636e\u884c\u987a\u5e8f\u4e00\u81f4\uff09"}),"\n",(0,r.jsxs)(n.li,{children:["\u4e0d\u652f\u6301 ",(0,r.jsx)(n.code,{children:"sort"})," \u53c2\u6570\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"merge"})," \u65b9\u6cd5\u6765\u5408\u5e76\u4e24\u4e2a\u6570\u636e\u6846\uff0c\u5e76\u6f14\u793a\u4e86\u5404\u79cd\u5408\u5e76\u65b9\u5f0f\uff08",(0,r.jsx)(n.code,{children:"inner"}),"\u3001",(0,r.jsx)(n.code,{children:"left"}),"\u3001",(0,r.jsx)(n.code,{children:"right"}),"\u3001",(0,r.jsx)(n.code,{children:"outer"}),"\u3001",(0,r.jsx)(n.code,{children:"cross"}),"\uff09\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"\u6821\u9a8c\u53c2\u6570\u683c\u5f0f",children:"\u6821\u9a8c\u53c2\u6570\u683c\u5f0f"}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u6f14\u793a\u4e86\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u53c2\u6570\u6821\u9a8c\u3002\u5728\u4e0b\u9762\u7684\u4ee3\u7801\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e24\u4e2a\u6570\u636e\u6846 ",(0,r.jsx)(n.code,{children:"d1"})," \u548c ",(0,r.jsx)(n.code,{children:"d2"}),"\uff0c\u5e76\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"assert.fails"})," \u6d4b\u8bd5\u4e86 ",(0,r.jsx)(n.code,{children:"merge"})," \u51fd\u6570\u5728\u5404\u79cd\u65e0\u6548\u53c2\u6570\u7ec4\u5408\u4e0b\u662f\u5426\u629b\u51fa\u9884\u671f\u7684\u9519\u8bef\u3002\u6bcf\u4e2a ",(0,r.jsx)(n.code,{children:"assert.fails"})," \u8bed\u53e5\u540e\u9762\u90fd\u9644\u6709\u6ce8\u91ca\uff0c\u89e3\u91ca\u4e86\u8be5\u6d4b\u8bd5\u7684\u5177\u4f53\u60c5\u51b5\u548c\u671f\u671b\u7684\u9519\u8bef\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'# \u793a\u4f8b\u6570\u636e\u6846\nd1 = DataFrame({\n  "year": [2021, 2022, 2023, 2024],\n  "month": [1, 2, 3, 4],\n  "price": [1, 2, 3, 4],\n})\n\nd2 = DataFrame({\n  "year": [2024, 2021, 2022, 2023],\n  "month": [5, 1, 2, 3],\n  "count": [4, 3, 2, 1],\n  "price": [1, 2, 3, 4],\n})\n\n# \u53c2\u6570\u6821\u9a8c\u793a\u4f8b\nassert.fails(lambda: d1.merge(d2), \'must pass argument "on" OR "left_on" and "right_on"\')  # \u6d4b\u8bd5\u672a\u63d0\u4f9b \'on\' \u6216 \'left_on\' \u548c \'right_on\' \u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, right_on="year_A"), \'must pass argument "on" OR "left_on" and "right_on"\')  # \u6d4b\u8bd5\u4ec5\u63d0\u4f9b \'right_on\' \u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, left_on=None, right_on="year_A"), \'must pass argument "on" OR "left_on" and "right_on"\')  # \u6d4b\u8bd5 \'left_on\' \u4e3a None \u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, left_on=\'year\'), \'must pass argument "on" OR "left_on" and "right_on"\')  # \u6d4b\u8bd5\u4ec5\u63d0\u4f9b \'left_on\' \u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, left_on=[\'year\'], right_on="year"), \'"left_on" and "right_on" must be same type\')  # \u6d4b\u8bd5 \'left_on\' \u548c \'right_on\' \u7c7b\u578b\u4e0d\u540c\u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, left_on="year", right_on=["year"]), \'"left_on" and "right_on" must be same type\')  # \u6d4b\u8bd5 \'left_on\' \u548c \'right_on\' \u7c7b\u578b\u4e0d\u540c\u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, left_on=["year", "month"], right_on=["year"]), \'"left_on" and "right_on" must be same length\')  # \u6d4b\u8bd5 \'left_on\' \u548c \'right_on\' \u957f\u5ea6\u4e0d\u540c\u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, left_on=["year"], right_on=["year", "month"]), \'"left_on" and "right_on" must be same length\')  # \u6d4b\u8bd5 \'left_on\' \u548c \'right_on\' \u957f\u5ea6\u4e0d\u540c\u65f6\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, how="cross", on=["year"]), \'can not pass argument "on", "left_on" or "right_on" when "how" is "cross\')  # \u6d4b\u8bd5\u5728 \'how\' \u4e3a \'cross\' \u65f6\u4f20\u9012 \'on\' \u53c2\u6570\u662f\u5426\u629b\u51fa\u9519\u8bef\nassert.fails(lambda: d1.merge(d2, how="cross", left_on=["year"], right_on=["year"]), \'can not pass argument "on", "left_on" or "right_on" when "how" is "cross\')  # \u6d4b\u8bd5\u5728 \'how\' \u4e3a \'cross\' \u65f6\u4f20\u9012 \'left_on\' \u548c \'right_on\' \u53c2\u6570\u662f\u5426\u629b\u51fa\u9519\u8bef\n\n'})}),"\n",(0,r.jsx)(n.h4,{id:"inner-\u5408\u5e76",children:"inner \u5408\u5e76"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"inner"})," \u5408\u5e76\u53ea\u4fdd\u7559\u4e24\u4e2a\u6570\u636e\u6846\u4e2d\u5171\u6709\u7684\u884c\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'# inner \u5408\u5e76\u793a\u4f8b\nd3 = d1.merge(d2, on=["year", "month"])\nreturn d3\n\n# \u9a8c\u8bc1\u7ed3\u679c\nassert.eq(d3.shape, (3, 5))\nassert.eq(list(d3.columns), ["year", "month", "price_x", "count", "price_y"])\nassert.eq(list(d3["year"]), [2021, 2022, 2023])\nassert.eq(list(d3["month"]), [1, 2, 3])\nassert.eq(list(d3["price_x"]), [1, 2, 3])\nassert.eq(list(d3["count"]), [3, 2, 1])\nassert.eq(list(d3["price_y"]), [2, 3, 4])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"left-\u5408\u5e76",children:"left \u5408\u5e76"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"left"})," \u5408\u5e76\u4fdd\u7559\u5de6\u4fa7\u6570\u636e\u6846\u4e2d\u7684\u6240\u6709\u884c\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'# \u4fee\u6539 d2 \u793a\u4f8b\u6570\u636e\u6846\nd2 = DataFrame({\n  "year": [2024, 2021, 2022, 2023, 2023],\n  "month": [5, 1, 2, 3, 3],\n  "count": [4, 3, 2, 1, 1],\n  "price": [1, 2, 3, 4, 4],\n})\n\n# left \u5408\u5e76\u793a\u4f8b\nd3 = d1.merge(d2, how="left", on=["year", "month"])\nreturn d3\n\n# \u9a8c\u8bc1\u7ed3\u679c\nassert.eq(d3.shape, (5, 5))\nassert.eq(list(d3.columns), ["year", "month", "price_x", "count", "price_y"])\nassert.eq(list(d3["year"]), [2021, 2022, 2023, 2023, 2024])\nassert.eq(list(d3["month"]), [1, 2, 3, 3, 4])\nassert.eq(list(d3["price_x"]), [1, 2, 3, 3, 4])\nassert.eq(list(d3["count"]), [3.0, 2.0, 1.0, 1.0, None])\nassert.eq(list(d3["price_y"]), [2.0, 3.0, 4.0, 4.0, None])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"right-\u5408\u5e76",children:"right \u5408\u5e76"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"right"})," \u5408\u5e76\u4fdd\u7559\u53f3\u4fa7\u6570\u636e\u6846\u4e2d\u7684\u6240\u6709\u884c\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'# right \u5408\u5e76\u793a\u4f8b\nd3 = d1.merge(d2, how="right", on=["year", "month"])\nreturn d3\n\n# \u9a8c\u8bc1\u7ed3\u679c\nassert.eq(d3.shape, (5, 5))\nassert.eq(list(d3.columns), ["year", "month", "count", "price_y", "price_x"])\nassert.eq(list(d3["year"]), [2024, 2021, 2022, 2023, 2023])\nassert.eq(list(d3["month"]), [5, 1, 2, 3, 3])\nassert.eq(list(d3["price_x"]), [None, 1.0, 2.0, 3.0, 3.0])\nassert.eq(list(d3["count"]), [4, 3, 2, 1, 1])\nassert.eq(list(d3["price_y"]), [1, 2, 3, 4, 4])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"outer-\u5408\u5e76",children:"outer \u5408\u5e76"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"outer"})," \u5408\u5e76\u8fd4\u56de\u4e24\u4e2a\u6570\u636e\u6846\u7684\u5e76\u96c6\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'# outer \u5408\u5e76\u793a\u4f8b\nd3 = d1.merge(d2, how="outer", on=["year", "month"])\nreturn d3\n\n# \u9a8c\u8bc1\u7ed3\u679c\nassert.eq(d3.shape, (6, 5))\nassert.eq(list(d3.columns), [\'year\', \'month\', \'price_x\', \'count\', \'price_y\'])\nassert.eq(list(d3["year"]), [2021, 2022, 2023, 2023, 2024, 2024])\nassert.eq(list(d3["month"]), [1, 2, 3, 3, 4, 5])\nassert.eq(list(d3["price_x"]), [1.0, 2.0, 3.0, 3.0, 4.0, None])\nassert.eq(list(d3["count"]), [3.0, 2.0, 1.0, 1.0, None, 4.0])\nassert.eq(list(d3["price_y"]), [2.0, 3.0, 4.0, 4.0, None, 1.0])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"cross-\u5408\u5e76",children:"cross \u5408\u5e76"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cross"})," \u5408\u5e76\u8fd4\u56de\u4e24\u4e2a\u6570\u636e\u6846\u7684\u7b1b\u5361\u5c14\u79ef\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'# cross \u5408\u5e76\u793a\u4f8b\nd3 = d1.merge(d2, how="cross")\nreturn d3\n\n# \u9a8c\u8bc1\u7ed3\u679c\nassert.eq(d3.shape, (20, 7))\nassert.eq(list(d3.columns), [\'year_x\', \'month_x\', \'price_x\', \'year_y\', \'month_y\', \'count\', \'price_y\'])\nassert.eq(list(d3["year_x"]), [2021, 2022, 2023, 2024, 2021, 2022, 2023, 2024, 2021, 2022, 2023, 2024, 2021, 2022, 2023, 2024, 2021, 2022, 2023, 2024])\nassert.eq(list(d3["month_x"]), [1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4])\nassert.eq(list(d3["price_x"]), [1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4])\nassert.eq(list(d3["year_y"]), [2024, 2024, 2024, 2024, 2021, 2021, 2021, 2021, 2022, 2022, 2022, 2022, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023])\nassert.eq(list(d3["month_y"]), [5, 5, 5, 5, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3])\nassert.eq(list(d3["count"]), [4, 4, 4, 4, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1])\nassert.eq(list(d3["price_y"]), [1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4])\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1100:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(758);const t={},d=r.createContext(t);function l(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);